/*
  HTMLMovieMaker 0.0.1 <http://jintoppy.github.io/HTMLVideoMaker>
  Copyright (c) 2014 Jinto Jose

  Released under MIT License
*/
var HTMLMovieMaker=function(){"use strict";function a(a,b){for(var c in b)a.style[c]=b[c]}function b(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}function c(a){c.superclass.constructor.call(this,a);var b=this.objectConfig,d=document.createElement("img");return d.src=b.src,d.alt=b.text,this.setInitialStyles(d,b),this.dom=d,this}function d(a){d.superclass.constructor.call(this,a);var b=this.objectConfig,c=document.createElement("video");return c.src=b.src,c.autoplay=!1,c.poster=b.posterImageUrl?b.posterImageUrl:"",this.setInitialStyles(c,b),this.dom=c,this}function e(a){e.superclass.constructor.call(this,a);var b=this.objectConfig,c=document.createElement("span");return c.innerHTML=b.text,c.className="text-object",this.setInitialStyles(c,b),this.dom=c,this}function f(a){I(),J(N,a),o()}function g(){if(R=0,K={},L){var a=document.getElementById(L.id);L=null,a&&a.remove()}}function h(){var a=document.createElement("button");a.id="play-pause-button",a.className="play",a.title="play",a.style.float="left",a.innerHTML="Play";var b=document.createElement("button");b.id="stop",b.title="stop",b.style.float="left",b.style.display="none",b.innerHTML="Stop";var c=document.createElement("button");c.id="fullscreen-button",c.title="FullScreen",c.innerHTML="FullScreen";var d=document.createElement("div");d.id="video-controls",d.appendChild(a),d.appendChild(b);var e=T.wrapper.offsetTop+N.height+10,f=T.wrapper.offsetLeft+(N.width/2-100);d.style.position="absolute",d.style.top=e+"px",d.style.left=f+"px",d.style.display="block",N.allowFullScreen&&d.appendChild(c),document.body.appendChild(d)}function i(a){var b=T.toolbar.playPauseButton;a?(b.title="play",b.innerHTML="Play",b.className="play"):(b.title="pause",b.innerHTML="Pause",b.className="pause")}function j(){var a=T.toolbar.playPauseButton;"play"===a.title?(a.title="pause",a.innerHTML="Pause",a.className="pause",P===!1?s():w()):(a.title="play",a.innerHTML="Play",a.className="play",v())}function k(){var a=document.body;a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),W=!0}function l(){T.toolbar.playPauseButton.addEventListener("click",j),T.toolbar.stopButton.addEventListener("click",x),T.toolbar.fullScreenButton.addEventListener("click",k)}function m(){T.toolbar=document.querySelector("#video-controls"),T.toolbar.playPauseButton=document.querySelector("#video-controls #play-pause-button"),T.toolbar.stopButton=document.querySelector("#video-controls #stop"),T.toolbar.fullScreenButton=document.querySelector("#video-controls #fullscreen-button")}function n(a){var b=new X(a);return b.dom.id="scene_"+U.length,b.dom.style.display="none",U.push(b),b}function o(){var a;N.containerDiv&&0!==document.querySelector(N.containerDiv).length?a=document.querySelector(N.containerDiv):(a=document.createElement("div"),a.id="movie-container",a.className="moviemaker-wrapper",document.body.appendChild(a)),a.style.width=parseInt(N.width,10)+"px",a.style.height=parseInt(N.height,10)+"px",T.wrapper=a,N.controls===!0&&h(),m(),l(),p()}function p(){var a=document.createElement("style"),b=T.wrapper.style,c=".moviemaker-wrapper * { max-width: "+b.width+"; max-height: "+b.height+"; }";a.innerHTML=c,document.head.appendChild(a)}function q(a,b){var c="";return c+=a.toLowerCase()+": "+b+";",c+="-webkit-"+a.toLowerCase()+": "+b+";",c+="-moz-"+a.toLowerCase()+": "+b+";",c+="-ms-"+a.toLowerCase()+": "+b+";"}function r(){for(var a=document.createElement("style"),b="",c=0,d=U.length;d>c;c++)for(var e=U[c].objects,f=0,g=e.length;g>f;f++){var h=e[f],i=h.objectConfig.keyframes;if(i){var j=i.length;if(j>0){var k=i[0].start,l=i[j-1].start,m=parseInt(l,10)-parseInt(k,10),n="scene_"+c+"_object_"+f+"_anim";h.animationName=n,h.animationTime=m,h.dom.style.animationDelay=k,h.dom.style.webkitAnimationDelay=k,b+="@"+V+"keyframes "+n+" { ";for(var o=0;j>o;o++){var p=i[o],r="";for(var s in p.styles)r+="filter"!=s&&s in document.body.style?s+":"+p.styles[s]+";":q(s,p.styles[s]);if(0===o)b+="0% {"+r+" }";else if(o==j-1)b+="100% {"+r+" }";else{var t=Math.floor(p.start/l*100);b+=t+"% {"+r+" }"}}b+="}"}}}a.innerHTML=b,a.id="moviemaker-animation-style",document.head.appendChild(a),L=a}function s(){return g(),t(),r(),P=!0,T.toolbar.stopButton.style.display="block",S.animation?void z():void console.log("Animation not supported. Will not work.")}function t(){U.forEach(function(a){T.wrapper.appendChild(a.dom),u(a)})}function u(a){a.objects.forEach(function(b){a.dom.appendChild(b.dom)})}function v(){O=!0,C(K.objects),U.forEach(function(a){clearTimeout(a.sceneConfig.timeoutObj)}),K.pausedTime=Date.now()}function w(){O=!1;var a=K.startedTime-K.pausedTime,b=K.sceneConfig.duration-a;D(K.objects),K.sceneConfig.timeoutObj=setTimeout(z,b)}function x(){Q=!0,P=!1,U.forEach(function(a){clearTimeout(a.sceneConfig.timeoutObj),y(a)}),T.toolbar.stopButton.style.display="none",g(),i(!0)}function y(a){a.dom.style.animation="",a.dom.style.webkitAnimation="",a.dom.style.display="none"}function z(){B(R),R!=U.length-1&&(U[R+1].sceneConfig.timeoutObj=setTimeout(z,U[R].sceneConfig.duration),R++)}function A(a,b,c){var d=new CustomEvent(a,c);b.dispatchEvent(d)}function B(a){0!==a&&H(a-1),U[a].startedTime=Date.now(),U[a].dom.style.display="block",K=U[a],A("onsceneshow",K.dom,K),G(U[a],U[a].objects)}function C(a){if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b];"VIDEO"===c.objectConfig.type&&F(c),c.animationName&&(c.dom.style.animationPlayState="paused",c.dom.style.webkitAnimationPlayState="paused")}}function D(a){if(a.length>0)for(var b=0;b<a.length;b++){var c=a[b];"VIDEO"===c.objectConfig.type&&E(c),c.animationName&&(c.dom.style.animationPlayState="running",c.dom.style.webkitAnimationPlayState="running")}}function E(a){a.dom.play()}function F(a){a.dom.pause()}function G(a,b){if(b.length>0)for(var c=0;c<b.length;c++){var d=b[c];if("VIDEO"===d.objectConfig.type&&E(d),d.animationName){d.dom.style.animationName=d.animationName,d.dom.style.webkitAnimationName=d.animationName;var e=d.animationTime+"s";d.dom.style.animationDuration=e,d.dom.style.webkitAnimationDuration=e,d.dom.style.animationPlayState="running",d.dom.style.webkitAnimationPlayState="running"}}}function H(a){var b=U[a];y(b)}function I(){S.animation="webkitAnimation"in document.body.style||"animation"in document.body.style,S.transforms3d="WebkitPerspective"in document.body.style||"MozPerspective"in document.body.style||"msPerspective"in document.body.style||"OPerspective"in document.body.style||"perspective"in document.body.style,S.transforms2d="WebkitTransform"in document.body.style||"MozTransform"in document.body.style||"msTransform"in document.body.style||"OTransform"in document.body.style||"transform"in document.body.style,S.requestAnimationFrameMethod=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,S.requestAnimationFrame="function"==typeof S.requestAnimationFrameMethod,S.canvas=!!document.createElement("canvas").getContext,M=navigator.userAgent.match(/(iphone|ipod|android)/gi)}function J(a,b){for(var c in b)a[c]=b[c]}var K,L,M,N={width:800,height:500,name:"Untitled",createBy:"Jinto Jose",controls:!0,allowFullScreen:!1},O=!1,P=!1,Q=!1,R=0,S={},T={},U=[],V="-webkit-",W=!1,X=function(b){function c(){var b=document.createElement("div"),c=d.sceneConfig.style;return a(b,c),b.className="scene",d.dom=b,d.dom.style.display="none",d.dom.style.width="100%",d.dom.style.height="100%",d}this.sceneConfig={duration:2e3,name:"Scene",style:{backgroundColor:"#fff"}},J(this.sceneConfig,b);var d=this;c()};X.prototype.addObject=function(a){var b=Y.createObject(a);return this.objects=this.objects||[],b.dom.id="object_"+this.objects.length,this.objects.push(b),b},X.prototype.getProperties=function(){return this.sceneConfig},X.prototype.setProperties=function(b){J(this.sceneConfig,b),a(this.dom,this.sceneConfig.style)},X.prototype.getSceneElement=function(){return this.dom};var Y={createObject:function(a){var b,f=a?a.type:"TEXT";switch(f){case"TEXT":b=new e(a);break;case"IMAGE":b=new c(a);break;case"VIDEO":b=new d(a);break;default:b=new e(a)}return b}},Z=function(a){this.objectConfig={type:"TEXT",text:"Test content",style:{color:"blue"}},J(this.objectConfig,a)};return Z.prototype.getProperties=function(){return this.objectConfig},Z.prototype.setProperties=function(a){J(this.objectConfig,a)},Z.prototype.setInitialStyles=function(a,b){var c=b.styles;for(var d in c)a.style[d]=c[d];a.style.position="relative",a.style.top=b.y?b.y+"px":"0px",a.style.left=b.x?b.x+"px":"0px",a.style.animationPlayState="paused",a.style.MozAnimationPlayState="paused",a.style.webkitAnimationPlayState="paused",a.style.animationFillMode="forwards",a.style.MozAnimationFillMode="forwards",a.style.webkitAnimationFillMode="forwards"},b(c,Z),b(d,Z),b(e,Z),{createMovie:f,start:s,pause:v,stop:x,resume:w,addScene:n}}();