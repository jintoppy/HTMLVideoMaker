/*
  HTMLMovieMaker 0.0.1 <http://jintoppy.github.io/HTMLVideoMaker>
  Copyright (c) 2014 Jinto Jose

  Released under MIT License
*/
var HTMLMovieMaker=function(){"use strict";function a(a,b){for(var c in b)a.style[c]=b[c]}function b(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}function c(a){c.superclass.constructor.call(this,a);var b=this.objectConfig,d=document.createElement("img");return d.src=b.src,d.alt=b.text,this.setInitialStyles(d,b),this.dom=d,this}function d(a){d.superclass.constructor.call(this,a)}function e(a){e.superclass.constructor.call(this,a);var b=this.objectConfig,c=document.createElement("span");return c.innerHTML=b.text,c.className="text-object",this.setInitialStyles(c,b),this.dom=c,this}function f(a){F(),G(K,a),o()}function g(){if(O=0,H={},I){var a=document.getElementById(I.id);I=null,a&&a.remove()}}function h(){var a=document.createElement("button");a.id="play-pause-button",a.className="play",a.title="play",a.style.float="left",a.innerHTML="Play";var b=document.createElement("button");b.id="stop",b.title="stop",b.style.float="left",b.style.display="none",b.innerHTML="Stop";var c=document.createElement("button");c.id="fullscreen-button",c.title="FullScreen",c.innerHTML="FullScreen";var d=document.createElement("div");d.id="video-controls",d.appendChild(a),d.appendChild(b);var e=Q.wrapper.offsetTop+K.height+10,f=Q.wrapper.offsetLeft+(K.width/2-100);d.style.position="absolute",d.style.top=e+"px",d.style.left=f+"px",d.style.display="block",K.allowFullScreen&&d.appendChild(c),document.body.appendChild(d)}function i(a){var b=Q.toolbar.playPauseButton;a?(b.title="play",b.innerHTML="Play",b.className="play"):(b.title="pause",b.innerHTML="Pause",b.className="pause")}function j(){var a=Q.toolbar.playPauseButton;"play"===a.title?(a.title="pause",a.innerHTML="Pause",a.className="pause",M===!1?s():w()):(a.title="play",a.innerHTML="Play",a.className="play",v())}function k(){var a=document.body;a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),T=!0}function l(){Q.toolbar.playPauseButton.addEventListener("click",j),Q.toolbar.stopButton.addEventListener("click",x),Q.toolbar.fullScreenButton.addEventListener("click",k)}function m(){Q.toolbar=document.querySelector("#video-controls"),Q.toolbar.playPauseButton=document.querySelector("#video-controls #play-pause-button"),Q.toolbar.stopButton=document.querySelector("#video-controls #stop"),Q.toolbar.fullScreenButton=document.querySelector("#video-controls #fullscreen-button")}function n(a){var b=new U(a);return b.dom.id="scene_"+R.length,b.dom.style.display="none",R.push(b),b}function o(){var a;K.containerDiv&&0!==document.querySelector(K.containerDiv).length?a=document.querySelector(K.containerDiv):(a=document.createElement("div"),a.id="movie-container",a.className="moviemaker-wrapper",document.body.appendChild(a)),a.style.width=parseInt(K.width,10)+"px",a.style.height=parseInt(K.height,10)+"px",Q.wrapper=a,K.controls===!0&&h(),m(),l(),p()}function p(){var a=document.createElement("style"),b=Q.wrapper.style,c=".moviemaker-wrapper * { max-width: "+b.width+"; max-height: "+b.height+"; }";a.innerHTML=c,document.head.appendChild(a)}function q(a,b){var c="";return c+=a.toLowerCase()+": "+b+";",c+="-webkit-"+a.toLowerCase()+": "+b+";",c+="-moz-"+a.toLowerCase()+": "+b+";",c+="-ms-"+a.toLowerCase()+": "+b+";"}function r(){for(var a=document.createElement("style"),b="",c=0,d=R.length;d>c;c++)for(var e=R[c].objects,f=0,g=e.length;g>f;f++){var h=e[f],i=h.objectConfig.keyframes;if(i){var j=i.length;if(j>0){var k=i[0].start,l=i[j-1].start,m=parseInt(l)-parseInt(k),n="scene_"+c+"_object_"+f+"_anim";h.animationName=n,h.animationTime=m,h.dom.style.animationDelay=k,h.dom.style.webkitAnimationDelay=k,b+="@"+S+"keyframes "+n+" { ";for(var o=0;j>o;o++){var p=i[o],r="";for(var s in p.styles)r+="filter"!=s&&s in document.body.style?s+":"+p.styles[s]+";":q(s,p.styles[s]);if(0===o)b+="0% {"+r+" }";else if(o==j-1)b+="100% {"+r+" }";else{var t=Math.floor(p.start/l*100);b+=t+"% {"+r+" }"}}b+="}"}}}a.innerHTML=b,a.id="moviemaker-animation-style",document.head.appendChild(a),I=a}function s(){return g(),t(),r(),M=!0,Q.toolbar.stopButton.style.display="block",A(0),P.animation?void z():void console.log("Animation not supported. Will not work.")}function t(){R.forEach(function(a){Q.wrapper.appendChild(a.dom),u(a)})}function u(a){a.objects.forEach(function(b){a.dom.appendChild(b.dom)})}function v(){L=!0,B(H.objects),R.forEach(function(a){clearTimeout(a.sceneConfig.timeoutObj)}),H.pausedTime=Date.now()}function w(){L=!1;var a=H.startedTime-H.pausedTime,b=H.sceneConfig.duration-a;C(H.objects),H.sceneConfig.timeoutObj=setTimeout(z,b)}function x(){N=!0,M=!1,R.forEach(function(a){clearTimeout(a.sceneConfig.timeoutObj),y(a)}),Q.toolbar.stopButton.style.display="none",g(),i(!0)}function y(a){a.dom.style.animation="",a.dom.style.webkitAnimation="",a.dom.style.display="none"}function z(){A(O),O!=R.length-1&&(O++,R[O].sceneConfig.timeoutObj=setTimeout(z,R[O].sceneConfig.duration))}function A(a){0!==a&&E(a-1),R[a].startedTime=Date.now(),R[a].dom.style.display="block",H=R[a],D(R[a],R[a].objects)}function B(a){if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b];c.animationName&&(c.dom.style.animationPlayState="paused",c.dom.style.webkitAnimationPlayState="paused")}}function C(a){if(a.length>0)for(var b=0;b<a.length;b++){var c=a[b];c.animationName&&(c.dom.style.animationPlayState="running",c.dom.style.webkitAnimationPlayState="running")}}function D(a,b){if(b.length>0)for(var c=0;c<b.length;c++){var d=b[c];if(d.animationName){d.dom.style.animationName=d.animationName,d.dom.style.webkitAnimationName=d.animationName;var e=d.animationTime+"s";d.dom.style.animationDuration=e,d.dom.style.webkitAnimationDuration=e,d.dom.style.animationPlayState="running",d.dom.style.webkitAnimationPlayState="running"}}}function E(a){var b=R[a];y(b)}function F(){P.animation="webkitAnimation"in document.body.style||"animation"in document.body.style,P.transforms3d="WebkitPerspective"in document.body.style||"MozPerspective"in document.body.style||"msPerspective"in document.body.style||"OPerspective"in document.body.style||"perspective"in document.body.style,P.transforms2d="WebkitTransform"in document.body.style||"MozTransform"in document.body.style||"msTransform"in document.body.style||"OTransform"in document.body.style||"transform"in document.body.style,P.requestAnimationFrameMethod=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,P.requestAnimationFrame="function"==typeof P.requestAnimationFrameMethod,P.canvas=!!document.createElement("canvas").getContext,J=navigator.userAgent.match(/(iphone|ipod|android)/gi)}function G(a,b){for(var c in b)a[c]=b[c]}var H,I,J,K={width:800,height:500,name:"Untitled",createBy:"Jinto Jose",controls:!0,allowFullScreen:!1},L=!1,M=!1,N=!1,O=0,P={},Q={},R=[],S="-webkit-",T=!1,U=function(b){function c(){var b=document.createElement("div"),c=d.sceneConfig.style;return a(b,c),b.className="scene",d.dom=b,d.dom.style.display="none",d.dom.style.width="100%",d.dom.style.height="100%",d}this.sceneConfig={duration:2e3,name:"Scene",style:{backgroundColor:"#fff"}},G(this.sceneConfig,b);var d=this;c()};U.prototype.addObject=function(a){var b=V.createObject(a);return this.objects=this.objects||[],b.dom.id="object_"+this.objects.length,this.objects.push(b),b},U.prototype.getProperties=function(){return this.sceneConfig},U.prototype.setProperties=function(b){G(this.sceneConfig,b),a(this.dom,this.sceneConfig.style)};var V={createObject:function(a){var b,f=a?a.type:"TEXT";switch(f){case"TEXT":b=new e(a);break;case"IMAGE":b=new c(a);break;case"VIDEO":b=new d(a);break;default:b=new e(a)}return b}},W=function(a){this.objectConfig={type:"TEXT",text:"Test content",style:{color:"blue"}},G(this.objectConfig,a)};return W.prototype.getProperties=function(){return this.objectConfig},W.prototype.setProperties=function(a){G(this.objectConfig,a)},W.prototype.setInitialStyles=function(a,b){var c=b.styles;for(var d in c)a.style[d]=c[d];a.style.position="relative",a.style.top=b.y?b.y+"px":"0px",a.style.left=b.x?b.x+"px":"0px",a.style.animationPlayState="paused",a.style.MozAnimationPlayState="paused",a.style.webkitAnimationPlayState="paused",a.style.animationFillMode="forwards",a.style.MozAnimationFillMode="forwards",a.style.webkitAnimationFillMode="forwards"},b(c,W),b(d,W),b(e,W),{createMovie:f,start:s,pause:v,stop:x,resume:w,addScene:n}}();