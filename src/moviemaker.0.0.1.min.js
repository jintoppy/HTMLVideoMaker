/*
  HTMLMovieMaker 0.0.1 <http://jintoppy.github.io/HTMLVideoMaker>
  Copyright (c) 2014 Jinto Jose

  Released under MIT License
*/
var HTMLMovieMaker=function(a){"use strict";function b(a,b){for(var c in b)a.style[c]=b[c]}function c(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)}function d(a){d.superclass.constructor.call(this,a)}function e(a){e.superclass.constructor.call(this,a)}function f(a){f.superclass.constructor.call(this,a);var a=this.objectConfig,b=document.createElement("span");b.innerHTML=a.text,b.className="text-object";for(var c in a.style)b.style[c]=a.style[c];return b.style.position="relative",b.style.animationPlayState="paused",b.style.webkitAnimationPlayState="paused",this.dom=b,this}function g(a){B(),C(G,a),l()}function h(){if(K=0,D={},E){var a=document.getElementById(E.id);E=null,a&&a.remove()}}function i(){var b=a('<button id="start">Start</button>'),c=a('<button id="pause">Pause</button>'),d=a('<button id="stop">Stop</button>'),e=a('<div id="toolbar" />');e.css({position:"absolute",top:"50%",left:10}).append([b,c,d]),a(G.containerDiv).append(e)}function j(){M.wrapper=a(G.containerDiv),M.toolbar=a("#toolbar"),M.toolbar.startButton=a("#toolbar #start"),M.toolbar.pauseButton=a("#toolbar #pause"),M.toolbar.stopButton=a("#toolbar #stop")}function k(a){var b=new P(a);return b.dom.id="scene_"+N.length,b.dom.style.display="none",N.push(b),b}function l(){0===a(G.containerDiv).length&&a('<div id="movie-container" />').appendTo(document.body),a(G.containerDiv).css({width:G.width,height:G.height}),G.controls===!0&&i(),j()}function m(a,b){var c="";return c+=a.toLowerCase()+": "+b+";",c+="-webkit-"+a.toLowerCase()+": "+b+";",c+="-moz-"+a.toLowerCase()+": "+b+";",c+="-ms-"+a.toLowerCase()+": "+b+";"}function n(){for(var a=document.createElement("style"),b="",c=0,d=N.length;d>c;c++)for(var e=N[c].objects,f=0,g=e.length;g>f;f++){var h=e[f],i=h.objectConfig.keyframes;if(i){var j=i.length;if(j>0){var k=i[0].start,l=i[j-1].start,n=l-k,o="scene_"+c+"_object_"+f+"_anim";h.animationName=o,h.animationTime=n,h.dom.style.animationDelay=k,h.dom.style.webkitAnimationDelay=k,b+="@"+O+"keyframes "+o+" { ";for(var p=0;j>p;p++){var q=i[p],r="";for(var s in q.styles)r+=s in document.body.style?s+":"+q.styles[s]+";":m(s,q.styles[s]);if(0==p)b+="0% {"+r+" }";else if(p==j-1)b+="100% {"+r+" }";else{var t=Math.floor(q.start/l*100);b+=t+"% {"+r+" }"}}b+="}"}}}a.innerHTML=b,a.id="moviemaker-animation-style",document.head.appendChild(a),E=a}function o(){return h(),p(),n(),I=!0,w(0),L.animation?void v():void console.log("Animation not supported. Will not work.")}function p(){N.forEach(function(a){M.wrapper.append(a.dom),q(a)})}function q(a){a.objects.forEach(function(b){a.dom.appendChild(b.dom)})}function r(){H=!0,x(D.objects),N.forEach(function(a){clearTimeout(a.sceneConfig.timeoutObj)}),D.pausedTime=Date.now()}function s(){H=!1;var a=D.startedTime-D.pausedTime,b=D.sceneConfig.duration-a;y(D.objects),D.sceneConfig.timeoutObj=setTimeout(v,b)}function t(){J=!0,N.forEach(function(a){clearTimeout(a.sceneConfig.timeoutObj),u(a)}),h()}function u(a){a.dom.style.animation="",a.dom.style.webkitAnimation="",a.dom.style.display="none"}function v(){w(K),K!=N.length-1&&(K++,N[K].sceneConfig.timeoutObj=setTimeout(v,N[K].sceneConfig.duration))}function w(a){0!==a&&A(a-1),N[a].startedTime=Date.now(),N[a].dom.style.display="block",D=N[a],z(N[a].objects)}function x(a){if(a.length>0)for(var b=0;b<a.length;b++){var c=a[b];c.animationName&&(c.dom.style.animationPlayState="paused",c.dom.style.webkitAnimationPlayState="paused")}}function y(a){if(a.length>0)for(var b=0;b<a.length;b++){var c=a[b];c.animationName&&(c.dom.style.animationPlayState="running",c.dom.style.webkitAnimationPlayState="running")}}function z(a){if(a.length>0)for(var b=0;b<a.length;b++){var c=a[b];c.animationName&&(c.dom.style.animationName=c.animationName,c.dom.style.webkitAnimationName=c.animationName,c.dom.style.animationDuration="2s",c.dom.style.webkitAnimationDuration="2s",c.dom.style.animationPlayState="running",c.dom.style.webkitAnimationPlayState="running")}}function A(a){var b=N[a];u(b)}function B(){L.animation="webkitAnimation"in document.body.style||"animation"in document.body.style,L.transforms3d="WebkitPerspective"in document.body.style||"MozPerspective"in document.body.style||"msPerspective"in document.body.style||"OPerspective"in document.body.style||"perspective"in document.body.style,L.transforms2d="WebkitTransform"in document.body.style||"MozTransform"in document.body.style||"msTransform"in document.body.style||"OTransform"in document.body.style||"transform"in document.body.style,L.requestAnimationFrameMethod=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,L.requestAnimationFrame="function"==typeof L.requestAnimationFrameMethod,L.canvas=!!document.createElement("canvas").getContext,F=navigator.userAgent.match(/(iphone|ipod|android)/gi)}function C(a,b){for(var c in b)a[c]=b[c]}var D,E,F,G={width:900,height:700,name:"Untitled",createBy:"Jinto Jose",controls:!0,containerDiv:"#movie-container"},H=!1,I=!1,J=!1,K=0,L={},M={},N=[],O="-webkit-",P=function(a){function c(){var a=document.createElement("div"),c=d.sceneConfig.style;return b(a,c),a.className="scene",d.dom=a,d.dom.style.display="none",d}this.sceneConfig={duration:2e3,name:"Scene",style:{backgroundColor:"#fff"}},C(this.sceneConfig,a);var d=this;c()};P.prototype.addObject=function(a){var b=Q.createObject(a);return this.objects=this.objects||[],b.dom.id="object_"+this.objects.length,this.objects.push(b),b},P.prototype.getProperties=function(){return this.sceneConfig},P.prototype.setProperties=function(a){C(this.sceneConfig,a),b(this.dom,this.sceneConfig.style)};var Q={createObject:function(a){var b,c=a?a.type:"TEXT";switch(c){case"TEXT":b=new f(a);break;case"IMG":b=new d(a);break;case"VIDEO":b=new e(a);break;default:b=new f(a)}return b}},R=function(a){this.objectConfig={type:"TEXT",text:"Test content",style:{color:"blue"}},C(this.objectConfig,a)};return R.prototype.getProperties=function(){return this.objectConfig},R.prototype.setProperties=function(a){C(this.objectConfig,a)},c(d,R),c(e,R),c(f,R),{createMovie:g,start:o,pause:r,stop:t,resume:s,addScene:k}}(jQuery);